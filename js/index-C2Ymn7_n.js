import{d as a,o as e,c as l,w as t,T as s,a as n,b as i,t as o,r as c,e as u,f as r,h as v,g as d,m as p,i as m,j as f,k as g,n as y,l as V,u as b,F as C,p as O,q as E}from"./vendor-DCq9QlA3.js";!function(){const a=document.createElement("link").relList;if(!(a&&a.supports&&a.supports("modulepreload"))){for(const a of document.querySelectorAll('link[rel="modulepreload"]'))e(a);new MutationObserver((a=>{for(const l of a)if("childList"===l.type)for(const a of l.addedNodes)"LINK"===a.tagName&&"modulepreload"===a.rel&&e(a)})).observe(document,{childList:!0,subtree:!0})}function e(a){if(a.ep)return;a.ep=!0;const e=function(a){const e={};return a.integrity&&(e.integrity=a.integrity),a.referrerPolicy&&(e.referrerPolicy=a.referrerPolicy),"use-credentials"===a.crossOrigin?e.credentials="include":"anonymous"===a.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(a);fetch(a.href,e)}}();const h={class:"dialog-header"},k={class:"dialog-content"},R={key:0,class:"dialog-footer"},w=a({__name:"Dialog",props:{modelValue:{type:Boolean,default:!1},title:{default:"提示"},closeOnClickOverlay:{type:Boolean,default:!0},content:{default:void 0},footer:{default:void 0}},emits:["update:modelValue"],setup(a,{emit:v}){const d=a,p=v,m=()=>{p("update:modelValue",!1)},f=()=>{d.closeOnClickOverlay&&m()};return(a,v)=>(e(),l(s,{name:"dialog-fade"},{default:t((()=>[a.modelValue?(e(),n("div",{key:0,class:"dialog-overlay",onClick:f},[i("div",{class:"dialog-container",onClick:v[0]||(v[0]=r((()=>{}),["stop"]))},[i("div",h,[i("h3",null,o(a.title),1),i("button",{class:"close-btn",onClick:m},"×")]),i("div",k,[(e(),l(c(a.content)))]),a.footer?(e(),n("div",R,[(e(),l(c(a.footer)))])):u("",!0)])])):u("",!0)])),_:1}))}});function T(a){try{const{title:e="提示",content:l="",width:t="400px",closeOnClickOverlay:s=!0,footer:n=null,onClose:i=()=>{},onOpen:o=()=>{},className:c=""}=a,u=document.createElement("div");c&&u.classList.add(c),document.body.appendChild(u);const r={visible:d(!0),title:d(e),content:d("string"==typeof l?l:p(l))},g=()=>{try{y.unmount(),u.remove(),i(),r.currentDialog=void 0}catch(a){}},y=m({setup:()=>(f((()=>{try{o()}catch(a){}})),()=>v(w,{modelValue:r.visible.value||!1,"onUpdate:modelValue":a=>{r.visible.value=a,a||g()},title:r.title.value||"提示",width:t,closeOnClickOverlay:s,class:c,content:r.content.value,footer:n}))});y.mount(u);const V={close:()=>{r.visible.value=!1,g()},updateContent:a=>{r.content.value=a},updateTitle:a=>{r.title.value=a}};return r.currentDialog=V,V}catch(e){throw new Error("Failed to create dialog")}}const N={dialogs:new Set,add(a){this.dialogs.add(a)},remove(a){this.dialogs.delete(a)},closeAll(){this.dialogs.forEach((a=>a.close())),this.dialogs.clear()},get count(){return this.dialogs.size}};function U(a,e={}){return T({title:"警告",content:a,width:"300px",footer:{setup:()=>()=>v("button",{onClick:()=>N.closeAll(),style:{width:"100%",margin:"0",backgroundColor:"var(--error-color)",color:"white"}},"确定")},className:"alert-dialog",...e})}const I=(a,e)=>a.toFixed(e).padStart(5,"0"),_=a=>{let e=0;for(let l=0;l<4;l++)e+=a[l];return e&=65535,e},A=a=>({FunctionCode:a[1]<<8|a[0],Value:a[3]<<8|a[2],CheckValue:a[5]<<8|a[4]}),F=(a,e)=>"efficiency"===a||"power"===a?e.toFixed(1):I(e,2);var M=(a=>(a[a.EN=0]="EN",a[a.VREF=1]="VREF",a[a.IREF=2]="IREF",a[a.MODE=3]="MODE",a))(M||{}),D=(a=>(a[a.VIN=0]="VIN",a[a.IIN=1]="IIN",a[a.VOUT=2]="VOUT",a[a.IOUT=3]="IOUT",a[a.RUN_ERROR_TYPE=4]="RUN_ERROR_TYPE",a[a.RUN_MODE=5]="RUN_MODE",a[a.OUT_MODE=6]="OUT_MODE",a))(D||{});const L={class:"power-control-system"},P={class:"section status-section"},$={class:"port-config"},S={class:"connection-status"},B={class:"input-parameters"},x={class:"card-grid"},j={class:"card"},K={class:"value-container"},Y={class:"value-display"},q={class:"card"},W={class:"value-container"},G={class:"value-display"},X={class:"section output-section"},z={class:"card-grid"},H={class:"card"},J={class:"value-container"},Q={class:"value-display"},Z={class:"card"},aa={class:"value-container"},ea={class:"value-display"},la={class:"card"},ta={class:"value-container"},sa={class:"value-display"},na={class:"card"},ia={class:"value-container"},oa={class:"value-display"},ca={class:"section target-settings"},ua={class:"target-controls"},ra={class:"target-group"},va={class:"target-value"},da={class:"target-value"},pa={class:"control-group"},ma={class:"power-controls"},fa={class:"mode-controls"},ga={class:"section power-status"},ya={class:"status-tabs"},Va={class:"status-tab"},ba={class:"status-options"},Ca={class:"status-tab"},Oa={class:"status-options"},Ea={class:"status-tab"},ha={class:"status-options"},ka={class:"status-tab"},Ra={class:"status-options error-options"},wa={class:"section"},Ta={class:"info-container"},Na={class:"info"},Ua=["onClick"],Ia={class:"type"},_a={class:"message"};m(a({__name:"App",setup(a){const l=d(),t=d(),s=d(),c=d(),u=d(),r=d(!1),p=d(20),m=d(4),h=d(24),k=d(5),R=d(24),w=d(5),N=d(24),Aa=d(5),Fa=d(24),Ma=d(5),Da=d(0),La=d(0),Pa=d("BUCK"),$a=d("未工作"),Sa=d("CC"),Ba=d("正常"),xa=d([]);let ja,Ka=[],Ya=0,qa=0,Wa=0;const Ga={BUCK:0,BOOST:1,MIXED:2},Xa={CV:0,CC:1},za={OFFLINE:0,OVERCURRENT:1,OVERVOLTAGE:2,OVERTEMP:3};f((()=>{})),g((()=>{Ha()}));const Ha=async()=>{try{ja&&(await ja.cancel(),ja.releaseLock()),u.value&&await u.value.close()}catch(a){}finally{u.value=void 0,r.value=!1,clearTimeout(Ya),clearTimeout(Wa),Ka=[]}},Ja=async()=>{"serial"in navigator?r.value?await Ha():await(async()=>{try{u.value=await navigator.serial.requestPort(),await u.value.open({baudRate:115200}),r.value=!0,Qa()}catch(a){U("串口打开失败，请检查设备连接"),await Ha()}})():U("浏览器不支持串口通信")},Qa=async()=>{var a;if((null==(a=u.value)?void 0:a.readable)&&(ja=u.value.readable.getReader(),ja))try{for(;r.value;){const{value:a,done:e}=await ja.read();if(e)break;a&&(Ka.push(...Array.from(a)),0===Ya&&(Ya=window.setTimeout(Za,30)))}}catch(e){U("数据读取错误，连接已断开")}finally{null==ja||ja.releaseLock()}},Za=()=>{var a;if(clearTimeout(Ya),Ya=0,6===Ka.length){const e=new Uint8Array(Ka),l=A(e);if(_(e)!==l.CheckValue)return ne(),void(Ka=[]);const t={[D.VIN]:()=>ae("voltage",l.Value/100,!0),[D.IIN]:()=>ae("current",l.Value/100,!0),[D.VOUT]:()=>ae("voltage",l.Value/100,!1),[D.IOUT]:()=>ae("current",l.Value/100,!1),[D.RUN_ERROR_TYPE]:()=>oe(l.Value),[D.RUN_MODE]:()=>re(l.Value),[D.OUT_MODE]:()=>ve(l.Value)};null==(a=t[l.FunctionCode])||a.call(t),fe(e)}else ne();Ka=[]},ae=(a,e,l=!1)=>{const t=l?"voltage"===a?N.value:Aa.value:"voltage"===a?h.value:k.value;t!==e&&((l?"voltage"===a?Fa:Ma:"voltage"===a?R:w).value=t,l?"voltage"===a?N.value=e:Aa.value=e:"voltage"===a?h.value=e:k.value=e,ee(),ge(a,l))},ee=()=>{La.value=h.value*k.value;const a=N.value*Aa.value;a>0&&(Da.value=Math.min(La.value/a*100,100))},le=(a,e,l)=>{var t;if(!(null==(t=u.value)?void 0:t.writable))return void U("请先连接设备");const s=new Uint8Array([255&a,a>>8&255,255&e,e>>8&255,0,0]),n=u.value.writable.getWriter(),i=_(s);s[4]=255&i,s[5]=i>>8&255,n.write(s),n.releaseLock(),fe(s,"sent")},te=()=>le(M.EN,1),se=()=>le(M.EN,0),ne=()=>{qa>10?(U("收到过多无效数据，已自动关闭串口"),Ha(),qa=0,clearTimeout(Wa)):(qa++,clearTimeout(Wa),Wa=window.setTimeout((()=>{qa>10&&(U("收到过多无效数据，已自动关闭串口"),Ha()),qa=0,clearTimeout(Wa)}),6e4))};function ie(a){return{[za.OFFLINE]:"断线",[za.OVERCURRENT]:"过流",[za.OVERVOLTAGE]:"过压",[za.OVERTEMP]:"过温"}[a]??"正常"}const oe=a=>{Ba.value=ie(a)};function ce(a,e,l){var t;return(null==(t=Object.entries(e).find((([e,l])=>l===a)))?void 0:t[0])??l}const ue=(a,e,l,t)=>{var s;const n=null==(s=Object.entries(e).find((([e,l])=>l===a)))?void 0:s[0];l.value=n||t},re=a=>{ue(a,Ga,Pa,"未知运行模式")},ve=a=>{ue(a,Xa,Sa,"未知输出模式")};function de(a){return ce(a,Xa,"未知输出模式")}function pe(a,e){try{const t=new Uint8Array(a.split(" ").map((a=>parseInt(a,16)))),s=A(t),n={[M.VREF]:`设置电压: ${s.Value/100} V`,[M.IREF]:`设置电流: ${s.Value/100} A`,[M.EN]:""+(1===s.Value?"开机":"关机"),[M.MODE]:"设置模式: "+(0===s.Value?"CV":"CC")},i={[D.VIN]:`输入电压: ${s.Value/100} V`,[D.IIN]:`输入电流: ${s.Value/100} A`,[D.VOUT]:`输出电压: ${s.Value/100} V`,[D.IOUT]:`输出电流: ${s.Value/100} A`,[D.RUN_ERROR_TYPE]:`错误类型: ${ie(s.Value)}`,[D.RUN_MODE]:`运行模式: ${l=s.Value,ce(l,Ga,"未知运行模式")}`,[D.OUT_MODE]:`输出模式: ${de(s.Value)}`};return e?n[s.FunctionCode]:i[s.FunctionCode]}catch(t){return"数据解析错误"}var l}const me=()=>{xa.value=[]},fe=(a,e="received")=>{const l=Array.from(a).map((a=>a.toString(16).padStart(2,"0"))).join(" "),t=(new Date).toLocaleString();xa.value.length>=100&&xa.value.pop(),xa.value.unshift({message:l,type:e,timestamp:t})},ge=(a,e=!1)=>{const n=e?"voltage"===a?s:c:"voltage"===a?l:t;(null==n?void 0:n.value)&&(n.value.classList.remove("fade-in"),n.value.offsetWidth,n.value.classList.add("fade-in"))},ye=a=>{const e="voltage"===a,l=d(e?p.value:m.value),t=e?80:5,s=e?"V":"A",n=T({title:"设置"+(e?"电压":"电流"),content:{setup:()=>()=>v("div",{class:"dialog-input-container"},[v("input",{type:"number",value:l.value,onInput:a=>{const e=a.target.value,s=parseFloat(e);l.value=s>t?t:s<0?0:s},class:"dialog-input",placeholder:`请输入${e?"电压":"电流"}值`}),v("span",{class:"dialog-unit"},s)])},footer:{setup:()=>()=>v("div",{class:"dialog-footer"},[v("button",{onClick:()=>n.close(),class:"cancel-btn"},"取消"),v("button",{onClick:()=>{e?(p.value=l.value,le(M.VREF,Math.round(100*p.value))):(m.value=l.value,le(M.IREF,Math.round(100*m.value))),n.close()},class:"confirm-btn"},"确定")])}})},Ve=()=>ye("voltage"),be=()=>ye("current"),Ce=a=>{Sa.value!==a&&(Sa.value=a,le(M.MODE,"CV"===a?0:1))};return(a,d)=>(e(),n("div",L,[i("div",P,[d[9]||(d[9]=i("h3",null,"设备状态",-1)),i("div",$,[i("div",S,[i("i",{class:y(["status-icon",{connected:r.value}])},null,2),i("span",null,o(void 0===u.value?"未连接":"已连接"),1)]),i("button",{class:"connect-btn",onClick:Ja},o(r.value?"断开连接":"选择设备"),1)]),i("div",B,[d[8]||(d[8]=i("h4",null,"输入参数",-1)),i("div",x,[i("div",j,[d[4]||(d[4]=i("span",{class:"output-label"},"电压",-1)),i("div",K,[i("span",Y,[V(o(b(I)(N.value,2))+" ",1),d[2]||(d[2]=i("small",null,"V",-1))]),i("span",{class:"value-display value-animation",ref_key:"inputVoltageAnimation",ref:s},[V(o(b(I)(Fa.value,2))+" ",1),d[3]||(d[3]=i("small",null,"V",-1))],512)])]),i("div",q,[d[7]||(d[7]=i("span",{class:"output-label"},"电流",-1)),i("div",W,[i("span",G,[V(o(b(I)(Aa.value,2))+" ",1),d[5]||(d[5]=i("small",null,"A",-1))]),i("span",{class:"value-display value-animation",ref_key:"inputCurrentAnimation",ref:c},[V(o(b(I)(Ma.value,2))+" ",1),d[6]||(d[6]=i("small",null,"A",-1))],512)])])])])]),i("div",X,[d[20]||(d[20]=i("h3",null,"输出参数",-1)),i("div",z,[i("div",H,[d[12]||(d[12]=i("span",{class:"output-label"},"电压",-1)),i("div",J,[i("span",Q,[V(o(b(I)(h.value,2))+" ",1),d[10]||(d[10]=i("small",null,"V",-1))]),i("span",{class:"value-display value-animation",ref_key:"voltageAnimation",ref:l},[V(o(b(I)(R.value,2))+" ",1),d[11]||(d[11]=i("small",null,"V",-1))],512)])]),i("div",Z,[d[15]||(d[15]=i("span",{class:"output-label"},"电流",-1)),i("div",aa,[i("span",ea,[V(o(b(I)(k.value,2))+" ",1),d[13]||(d[13]=i("small",null,"A",-1))]),i("span",{class:"value-display value-animation",ref_key:"currentAnimation",ref:t},[V(o(b(I)(w.value,2))+" ",1),d[14]||(d[14]=i("small",null,"A",-1))],512)])]),i("div",la,[d[17]||(d[17]=i("span",{class:"output-label"},"效率",-1)),i("div",ta,[i("span",sa,[V(o(b(F)("efficiency",Da.value))+" ",1),d[16]||(d[16]=i("small",null,"%",-1))])])]),i("div",na,[d[19]||(d[19]=i("span",{class:"output-label"},"功耗",-1)),i("div",ia,[i("span",oa,[V(o(b(F)("power",La.value))+" ",1),d[18]||(d[18]=i("small",null,"W",-1))])])])])]),i("div",ca,[d[24]||(d[24]=i("h3",null,"目标设定",-1)),i("div",ua,[i("div",ra,[i("div",{class:"target-card",onClick:Ve},[i("div",va,o(p.value)+"V",1),d[21]||(d[21]=i("div",{class:"target-label"},"设置电压",-1))]),i("div",{class:"target-card",onClick:be},[i("div",da,o(m.value)+"A",1),d[22]||(d[22]=i("div",{class:"target-label"},"设置电流",-1))])]),i("div",pa,[i("div",ma,[i("button",{class:y(["power-btn",{active:"工作中"===$a.value}]),onClick:te},d[23]||(d[23]=[i("i",{class:"power-icon"},null,-1),V(" 开机 ")]),2),i("button",{class:"power-btn off",onClick:se},"关机")]),i("div",fa,[i("button",{class:y({active:"CV"===Sa.value}),onClick:d[0]||(d[0]=a=>Ce("CV"))},"CV",2),i("button",{class:y({active:"CC"===Sa.value}),onClick:d[1]||(d[1]=a=>Ce("CC"))},"CC",2)])])])]),i("div",ga,[d[29]||(d[29]=i("h3",null,"电源状态",-1)),i("div",ya,[i("div",Va,[d[25]||(d[25]=i("div",{class:"status-label"},"工作模式",-1)),i("div",ba,[(e(),n(C,null,O(["BUCK","BOOST","MIXED"],(a=>i("span",{key:a,class:y(["status-option",{active:Pa.value===a}])},o(a),3))),64))])]),i("div",Ca,[d[26]||(d[26]=i("div",{class:"status-label"},"工作状态",-1)),i("div",Oa,[(e(),n(C,null,O(["未工作","工作中"],(a=>i("span",{key:a,class:y(["status-option",{active:$a.value===a}])},o(a),3))),64))])]),i("div",Ea,[d[27]||(d[27]=i("div",{class:"status-label"},"输出模式",-1)),i("div",ha,[(e(),n(C,null,O(["CV","CC"],(a=>i("span",{key:a,class:y(["status-option",{active:Sa.value===a}])},o(a),3))),64))])]),i("div",ka,[d[28]||(d[28]=i("div",{class:"status-label"},"故障类型",-1)),i("div",Ra,[(e(),n(C,null,O(["正常","断线","过流","过压","过温"],(a=>i("span",{key:a,class:y(["status-option",{active:Ba.value===a}])},o(a),3))),64))])])])]),i("div",wa,[d[30]||(d[30]=i("h3",null,"发送/接收数据",-1)),i("div",Ta,[i("ul",Na,[(e(!0),n(C,null,O(xa.value,((a,l)=>(e(),n("li",{key:l,class:y([a.type,"clickable"]),onClick:e=>(a=>{const e=T({title:"数据详情",content:{setup:()=>()=>v("div",{class:"data-detail"},[v("div",{class:"detail-item"},[v("span",{class:"detail-label"},"类型:"),v("span",{class:"detail-value"},"sent"===a.type?"发送":"接收")]),v("div",{class:"detail-item"},[v("span",{class:"detail-label"},"时间:"),v("span",{class:"detail-value"},a.timestamp)]),v("div",{class:"detail-item"},[v("span",{class:"detail-label"},"数据:"),v("span",{class:"detail-value"},a.message)]),v("div",{class:"detail-item"},[v("span",{class:"detail-label"},"解释:"),v("span",{class:"detail-value"},pe(a.message,"sent"===a.type))])])},footer:{setup:()=>()=>v("button",{onClick:()=>e.close()},"关闭")}})})(a)},[i("span",Ia,o("sent"===a.type?"发送":"接收")+":",1),i("span",_a,o(a.message),1)],10,Ua)))),128))]),i("button",{class:"clear-btn",onClick:me,title:"清除历史记录"})])]),d[31]||(d[31]=E('<div class="section about"><div class="avatar-container"><div class="avatar-image"></div></div><a href="https://github.com/xiaowine" target="_blank"><div class="github-icon"></div></a><div class="author-name">xiao_wine</div></div>',1))]))}})).mount("#app");
