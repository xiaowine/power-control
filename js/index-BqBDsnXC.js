import{d as a,o as e,c as l,w as s,T as t,a as n,b as i,t as o,r as c,e as u,f as r,h as v,g as d,m as p,i as m,j as f,k as V,n as g,l as O,u as y,F as C,p as b,q as E}from"./vendor-CIRmji6s.js";!function(){const a=document.createElement("link").relList;if(!(a&&a.supports&&a.supports("modulepreload"))){for(const a of document.querySelectorAll('link[rel="modulepreload"]'))e(a);new MutationObserver((a=>{for(const l of a)if("childList"===l.type)for(const a of l.addedNodes)"LINK"===a.tagName&&"modulepreload"===a.rel&&e(a)})).observe(document,{childList:!0,subtree:!0})}function e(a){if(a.ep)return;a.ep=!0;const e=function(a){const e={};return a.integrity&&(e.integrity=a.integrity),a.referrerPolicy&&(e.referrerPolicy=a.referrerPolicy),"use-credentials"===a.crossOrigin?e.credentials="include":"anonymous"===a.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(a);fetch(a.href,e)}}();const _={class:"dialog-header"},R={class:"dialog-content"},k={key:0,class:"dialog-footer"},w=a({__name:"Dialog",props:{modelValue:{type:Boolean,default:!1},title:{default:"提示"},closeOnClickOverlay:{type:Boolean,default:!0},content:{default:void 0},footer:{default:void 0}},emits:["update:modelValue"],setup(a,{emit:v}){const d=a,p=v,m=()=>{p("update:modelValue",!1)},f=()=>{d.closeOnClickOverlay&&m()};return(a,v)=>(e(),l(t,{name:"dialog-fade"},{default:s((()=>[a.modelValue?(e(),n("div",{key:0,class:"dialog-overlay",onClick:f},[i("div",{class:"dialog-container",onClick:v[0]||(v[0]=r((()=>{}),["stop"]))},[i("div",_,[i("h3",null,o(a.title),1),i("button",{class:"close-btn",onClick:m},"×")]),i("div",R,[(e(),l(c(a.content)))]),a.footer?(e(),n("div",k,[(e(),l(c(a.footer)))])):u("",!0)])])):u("",!0)])),_:1}))}});function T(a){const{title:e="提示",content:l={},closeOnClickOverlay:s=!0,footer:t=null,onClose:n=()=>{},onOpen:i=()=>{},className:o=""}=a,c=document.createElement("div");o&&c.classList.add(o),document.body.appendChild(c);const u={visible:d(!0),title:d(e),content:d(p(l))},r=()=>{V.unmount(),c.remove(),n(),u.currentDialog=void 0},V=m({setup:()=>(f((()=>i())),()=>v(w,{modelValue:u.visible.value??!1,"onUpdate:modelValue":a=>{u.visible.value=a,a||r()},title:u.title.value??"",closeOnClickOverlay:s,class:o,content:u.content.value,footer:t}))});V.mount(c);const g={close:()=>{u.visible.value=!1,r()},updateContent:a=>{u.content.value=a},updateTitle:a=>{u.title.value=a}};return u.currentDialog=g,g}function h(a,e={}){const l=T({title:"警告",content:{setup:()=>()=>v("h3",{class:"data-detail"},a)},footer:{setup:()=>()=>v("div",{class:"dialog-footer"},[v("button",{onClick:()=>l.close(),style:{backgroundColor:"var(--error-color)",color:"white"}},"确定")])},className:"alert-dialog",...e});return l}const U=(a,e)=>a.toFixed(e).padStart(5,"0"),N=a=>{let e=0;for(let l=0;l<4;l++)e+=a[l];return e&=65535,e},I=a=>({FunctionCode:a[1]<<8|a[0],Value:a[3]<<8|a[2],CheckValue:a[5]<<8|a[4]}),P=(a,e)=>"efficiency"===a||"power"===a?e.toFixed(1):U(e,2);var D=(a=>(a[a.EN=0]="EN",a[a.VREF=1]="VREF",a[a.IREF=2]="IREF",a[a.OUT_MODE=3]="OUT_MODE",a))(D||{}),M=(a=>(a[a.VIN=0]="VIN",a[a.IIN=1]="IIN",a[a.VOUT=2]="VOUT",a[a.IOUT=3]="IOUT",a[a.RUN_ERROR_TYPE=4]="RUN_ERROR_TYPE",a[a.RUN_MODE=5]="RUN_MODE",a[a.OUT_MODE=6]="OUT_MODE",a[a.EN=7]="EN",a))(M||{});const A={class:"power-control-system"},F={class:"section status-section"},L={class:"port-config"},S={class:"connection-status"},x={class:"input-parameters"},$={class:"card-grid"},B={class:"card"},j={class:"value-container"},Y={class:"value-display"},K={class:"card"},W={class:"value-container"},q={class:"value-display"},G={class:"section output-section"},z={class:"card-grid"},H={class:"card"},X={class:"value-container"},J={class:"value-display"},Q={class:"card"},Z={class:"value-container"},aa={class:"value-display"},ea={class:"card"},la={class:"value-container"},sa={class:"value-display"},ta={class:"card"},na={class:"value-container"},ia={class:"value-display"},oa={class:"section target-settings"},ca={class:"target-controls"},ua={class:"target-group"},ra={class:"target-value"},va={class:"target-value"},da={class:"control-group"},pa={class:"power-controls"},ma={class:"mode-controls"},fa={class:"section power-status"},Va={class:"status-tabs"},ga={class:"status-tab"},Oa={class:"status-options"},ya={class:"status-tab"},Ca={class:"status-options"},ba={class:"status-tab"},Ea={class:"status-options"},_a={class:"status-tab"},Ra={class:"status-options error-options"},ka={class:"section"},wa={class:"info-container"},Ta={class:"info"},ha=["onClick"],Ua={class:"type"},Na={class:"message"},Ia=4096;m(a({__name:"App",setup(a){const l=.025458984375,s=3.3/1269.76,t=Ia/104.28,c=1269.76/3.3,u=d(),r=d(),p=d(),m=d(),_=d(),R=d(!1),k=d(20),w=d(4),Pa=d(24),Da=d(5),Ma=d(24),Aa=d(5),Fa=d(24),La=d(5),Sa=d(24),xa=d(5),$a=d(0),Ba=d(0),ja=d("BUCK"),Ya=d("未工作"),Ka=d("CV"),Wa=d("正常"),qa=d([]);let Ga,za=[],Ha=0,Xa=0,Ja=0;const Qa={BUCK:0,BOOST:1,MIXED:2},Za={CV:0,CC:1},ae={NONE:0,VIN_UVP_ER:1,VIN_OVP_ER:2,VOUT_UVP_ER:3,VOUT_OVP_ER:4,IIN_OCP_ER:5,IOUT_OCP_ER:6,SHORT_ER:7,TEMP_OVP_ER:8};f((()=>{})),V((()=>{ee()}));const ee=async()=>{try{Ga&&(await Ga.cancel(),Ga.releaseLock()),_.value&&await _.value.close()}catch(a){}finally{_.value=void 0,R.value=!1,clearTimeout(Ha),clearTimeout(Ja),za=[]}},le=async()=>{"serial"in navigator?R.value?await ee():await(async()=>{try{_.value=await navigator.serial.requestPort(),await _.value.open({baudRate:115200}),R.value=!0,se()}catch(a){h("串口打开失败，请检查设备连接"),await ee()}})():h("浏览器不支持串口通信")},se=async()=>{var a;if((null==(a=_.value)?void 0:a.readable)&&(Ga=_.value.readable.getReader(),Ga))try{for(;R.value;){const{value:a,done:e}=await Ga.read();if(e)break;a&&(za.push(...Array.from(a)),0===Ha&&(Ha=window.setTimeout(te,30)))}}catch(e){h("数据读取错误，连接已断开")}finally{null==Ga||Ga.releaseLock()}},te=()=>{var a;if(clearTimeout(Ha),Ha=0,6===za.length){const e=new Uint8Array(za),t=I(e);if(N(e)!==t.CheckValue)return ve(),void(za=[]);const n={[M.VIN]:()=>ne(t.Value*l,!0),[M.IIN]:()=>ie(t.Value*s,!0),[M.VOUT]:()=>ne(t.Value*l,!1),[M.IOUT]:()=>ie(t.Value*s,!1),[M.RUN_ERROR_TYPE]:()=>pe(t.Value),[M.RUN_MODE]:()=>Ve(t.Value),[M.OUT_MODE]:()=>ge(t.Value),[M.EN]:()=>Oe(t.Value)};null==(a=n[t.FunctionCode])||a.call(n),Ee(e)}else ve();za=[]},ne=(a,e=!1)=>{const l=e?Fa.value:Pa.value;l!==a&&((e?Sa:Ma).value=l,e?Fa.value=a:Pa.value=a,oe(),_e("voltage",e))},ie=(a,e=!1)=>{const l=e?La.value:Da.value;l!==a&&((e?xa:Aa).value=l,e?La.value=a:Da.value=a,oe(),_e("current",e))},oe=()=>{Ba.value=Pa.value*Da.value;const a=Fa.value*La.value;a>0&&($a.value=Math.min(Ba.value/a*100,100))},ce=(a,e,l)=>{var s;if(!(null==(s=_.value)?void 0:s.writable))return void h("请先连接设备");const t=new Uint8Array([255&a,a>>8&255,255&e,e>>8&255,0,0]),n=_.value.writable.getWriter(),i=N(t);t[4]=255&i,t[5]=i>>8&255,n.write(t),n.releaseLock(),Ee(t,"sent")},ue=()=>ce(D.EN,1),re=()=>ce(D.EN,0),ve=()=>{Xa>10?(h("收到过多无效数据，已自动关闭串口"),ee(),Xa=0,clearTimeout(Ja)):(Xa++,clearTimeout(Ja),Ja=window.setTimeout((()=>{Xa>10&&(h("收到过多无效数据，已自动关闭串口"),ee()),Xa=0,clearTimeout(Ja)}),6e4))};function de(a){return{[ae.NONE]:"正常",[ae.VIN_UVP_ER]:"输入欠压保护",[ae.VIN_OVP_ER]:"输入过压保护",[ae.VOUT_UVP_ER]:"输出欠压保护",[ae.VOUT_OVP_ER]:"输出过压保护",[ae.IIN_OCP_ER]:"输入过流保护",[ae.IOUT_OCP_ER]:"输出过流保护",[ae.SHORT_ER]:"输出短路保护",[ae.TEMP_OVP_ER]:"温度过高保护"}[a]??"正常"}const pe=a=>{Wa.value=de(a)};function me(a,e,l){var s;return(null==(s=Object.entries(e).find((([e,l])=>l===a)))?void 0:s[0])??l}const fe=(a,e,l,s)=>{var t;const n=null==(t=Object.entries(e).find((([e,l])=>l===a)))?void 0:t[0];l.value=n||s},Ve=a=>{fe(a,Qa,ja,"未知运行模式")},ge=a=>{fe(a,Za,Ka,"未知输出模式")},Oe=a=>{Ya.value=1===a?"工作中":"未工作"};function ye(a){return me(a,Za,"未知输出模式")}function Ce(a,e){try{const i=new Uint8Array(a.split(" ").map((a=>parseInt(a,16)))),o=I(i),u={[D.VREF]:`设置电压: ${o.Value*t} V`,[D.IREF]:`设置电流: ${o.Value*c} A`,[D.EN]:""+(1===o.Value?"开机":"关机"),[D.OUT_MODE]:"设置模式: "+(0===o.Value?"CV":"CC")},r={[M.VIN]:`输入电压: ${o.Value*l} V`,[M.IIN]:`输入电流: ${o.Value*s} A`,[M.VOUT]:`输出电压: ${o.Value*l} V`,[M.IOUT]:`输出电流: ${o.Value*s} A`,[M.RUN_ERROR_TYPE]:`错误类型: ${de(o.Value)}`,[M.RUN_MODE]:`运行模式: ${n=o.Value,me(n,Qa,"未知运行模式")}`,[M.OUT_MODE]:`输出模式: ${ye(o.Value)}`};return e?u[o.FunctionCode]:r[o.FunctionCode]}catch(i){return"数据解析错误"}var n}const be=()=>{qa.value=[]},Ee=(a,e="received")=>{const l=Array.from(a).map((a=>a.toString(16).padStart(2,"0"))).join(" "),s=(new Date).toLocaleString();qa.value.length>=100&&qa.value.pop(),qa.value.unshift({message:l,type:e,timestamp:s})},_e=(a,e=!1)=>{const l=e?"voltage"===a?p:m:"voltage"===a?u:r;(null==l?void 0:l.value)&&(l.value.classList.remove("fade-in"),l.value.offsetWidth,l.value.classList.add("fade-in"))},Re=a=>{const e="voltage"===a,l=d(e?k.value:w.value),s=e?80:5,t=e?"V":"A",n=T({title:"设置"+(e?"电压":"电流"),content:{setup:()=>()=>v("div",{class:"dialog-input-container"},[v("input",{type:"number",value:l.value,onInput:a=>{const e=a.target.value,t=parseFloat(e);l.value=t>s?s:t<0?0:t},class:"dialog-input",placeholder:`请输入${e?"电压":"电流"}值`}),v("span",{class:"dialog-unit"},t)])},footer:{setup:()=>()=>v("div",{class:"dialog-footer"},[v("button",{onClick:()=>n.close(),class:"cancel-btn"},"���消"),v("button",{onClick:()=>{e?(k.value=l.value,ce(D.VREF,Math.round(100*k.value))):(w.value=l.value,ce(D.IREF,Math.round(100*w.value))),n.close()},class:"confirm-btn"},"确定")])}})},ke=()=>Re("voltage"),we=()=>Re("current"),Te=a=>{Ka.value!==a&&ce(D.OUT_MODE,"CV"===a?0:1)};return(a,l)=>(e(),n("div",A,[i("div",F,[l[8]||(l[8]=i("h3",null,"设备状态",-1)),i("div",L,[i("div",S,[i("i",{class:g(["status-icon",{connected:R.value}])},null,2),i("span",null,o(void 0===_.value?"未连接":"已连接"),1)]),i("button",{class:"connect-btn",onClick:le},o(R.value?"断开连接":"选择设备"),1)]),i("div",x,[i("div",$,[i("div",B,[l[4]||(l[4]=i("span",{class:"output-label"},"电压",-1)),i("div",j,[i("span",Y,[O(o(y(U)(Fa.value,2))+" ",1),l[2]||(l[2]=i("small",null,"V",-1))]),i("span",{class:"value-display value-animation",ref_key:"inputVoltageAnimation",ref:p},[O(o(y(U)(Sa.value,2))+" ",1),l[3]||(l[3]=i("small",null,"V",-1))],512)])]),i("div",K,[l[7]||(l[7]=i("span",{class:"output-label"},"电流",-1)),i("div",W,[i("span",q,[O(o(y(U)(La.value,2))+" ",1),l[5]||(l[5]=i("small",null,"A",-1))]),i("span",{class:"value-display value-animation",ref_key:"inputCurrentAnimation",ref:m},[O(o(y(U)(xa.value,2))+" ",1),l[6]||(l[6]=i("small",null,"A",-1))],512)])])])])]),i("div",G,[l[19]||(l[19]=i("h3",null,"输出参数",-1)),i("div",z,[i("div",H,[l[11]||(l[11]=i("span",{class:"output-label"},"电压",-1)),i("div",X,[i("span",J,[O(o(y(U)(Pa.value,2))+" ",1),l[9]||(l[9]=i("small",null,"V",-1))]),i("span",{class:"value-display value-animation",ref_key:"voltageAnimation",ref:u},[O(o(y(U)(Ma.value,2))+" ",1),l[10]||(l[10]=i("small",null,"V",-1))],512)])]),i("div",Q,[l[14]||(l[14]=i("span",{class:"output-label"},"电流",-1)),i("div",Z,[i("span",aa,[O(o(y(U)(Da.value,2))+" ",1),l[12]||(l[12]=i("small",null,"A",-1))]),i("span",{class:"value-display value-animation",ref_key:"currentAnimation",ref:r},[O(o(y(U)(Aa.value,2))+" ",1),l[13]||(l[13]=i("small",null,"A",-1))],512)])]),i("div",ea,[l[16]||(l[16]=i("span",{class:"output-label"},"效率",-1)),i("div",la,[i("span",sa,[O(o(y(P)("efficiency",$a.value))+" ",1),l[15]||(l[15]=i("small",null,"%",-1))])])]),i("div",ta,[l[18]||(l[18]=i("span",{class:"output-label"},"功耗",-1)),i("div",na,[i("span",ia,[O(o(y(P)("power",Ba.value))+" ",1),l[17]||(l[17]=i("small",null,"W",-1))])])])])]),i("div",oa,[l[23]||(l[23]=i("h3",null,"目标设定",-1)),i("div",ca,[i("div",ua,[i("div",{class:"target-card",onClick:ke},[i("div",ra,o(k.value)+"V",1),l[20]||(l[20]=i("div",{class:"target-label"},"设置电压",-1))]),i("div",{class:"target-card",onClick:we},[i("div",va,o(w.value)+"A",1),l[21]||(l[21]=i("div",{class:"target-label"},"设置电流",-1))])]),i("div",da,[i("div",pa,[i("button",{class:g(["power-btn",{active:"工作中"===Ya.value}]),onClick:ue},l[22]||(l[22]=[i("img",{src:"data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1733847952494'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='4318'%20data-darkreader-inline-fill=''%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='256'%20height='256'%3e%3cpath%20d='M561.312102%2068.191078l-98.624205%200%200%20493.121024%2098.624205%200L561.312102%2068.191078zM799.735283%20174.951591l-69.77618%2069.77618c77.420277%2063.36619%20127.225613%20159.27761%20127.225613%20267.271206%200%20190.590779-154.592914%20345.184717-345.184717%20345.184717S166.815283%20702.590779%20166.815283%20512c0-107.993596%2049.805336-203.905016%20127.225613-267.271206l-69.77618-69.77618C129.0911%20256.316713%2068.191078%20376.884696%2068.191078%20512c0%20245.080811%20198.72811%20443.808922%20443.808922%20443.808922s443.808922-198.72811%20443.808922-443.808922C955.808922%20376.884696%20894.907876%20256.316713%20799.735283%20174.951591z'%20p-id='4319'%3e%3c/path%3e%3c/svg%3e",alt:"power",class:"power-icon"},null,-1),O(" 开机 ")]),2),i("button",{class:"power-btn off",onClick:re},"关机")]),i("div",ma,[i("button",{class:g({active:"CV"===Ka.value}),onClick:l[0]||(l[0]=a=>Te("CV"))},"CV",2),i("button",{class:g({active:"CC"===Ka.value}),onClick:l[1]||(l[1]=a=>Te("CC"))},"CC",2)])])])]),i("div",fa,[l[28]||(l[28]=i("h3",null,"电源状态",-1)),i("div",Va,[i("div",ga,[l[24]||(l[24]=i("div",{class:"status-label"},"工作模式",-1)),i("div",Oa,[(e(),n(C,null,b(["BUCK","BOOST","MIXED"],(a=>i("span",{key:a,class:g(["status-option",{active:ja.value===a}])},o(a),3))),64))])]),i("div",ya,[l[25]||(l[25]=i("div",{class:"status-label"},"工作状态",-1)),i("div",Ca,[(e(),n(C,null,b(["未工作","工作中"],(a=>i("span",{key:a,class:g(["status-option",{active:Ya.value===a}])},o(a),3))),64))])]),i("div",ba,[l[26]||(l[26]=i("div",{class:"status-label"},"输出模式",-1)),i("div",Ea,[(e(),n(C,null,b(["CV","CC"],(a=>i("span",{key:a,class:g(["status-option",{active:Ka.value===a}])},o(a),3))),64))])]),i("div",_a,[l[27]||(l[27]=i("div",{class:"status-label"},"故障类型",-1)),i("div",Ra,[(e(),n(C,null,b(["正常","输入欠压保护","输入过压保护","输出欠压保护","输出过压保护","输入过流保护","输出过流保护","输出短路保护","温度过高保护"],(a=>i("span",{key:a,class:g(["status-option",{active:Wa.value===a}])},o(a),3))),64))])])])]),i("div",ka,[l[29]||(l[29]=i("h3",null,"发送/接收数据",-1)),i("div",wa,[i("ul",Ta,[(e(!0),n(C,null,b(qa.value,((a,l)=>(e(),n("li",{key:l,class:g([a.type,"clickable"]),onClick:e=>(a=>{const e=T({title:"数据详情",content:{setup:()=>()=>v("div",{class:"data-detail"},[v("div",{class:"detail-item"},[v("span",{class:"detail-label"},"类型:"),v("span",{class:"detail-value"},"sent"===a.type?"发送":"接收")]),v("div",{class:"detail-item"},[v("span",{class:"detail-label"},"时间:"),v("span",{class:"detail-value"},a.timestamp)]),v("div",{class:"detail-item"},[v("span",{class:"detail-label"},"数据:"),v("span",{class:"detail-value"},a.message)]),v("div",{class:"detail-item"},[v("span",{class:"detail-label"},"解释:"),v("span",{class:"detail-value"},Ce(a.message,"sent"===a.type))])])},footer:{setup:()=>()=>v("button",{onClick:()=>e.close()},"关闭")}})})(a)},[i("span",Ua,o("sent"===a.type?"发送":"接收")+":",1),i("span",Na,o(a.message),1)],10,ha)))),128))]),i("button",{class:"clear-btn",onClick:be,title:"清除历史记录"})])]),l[30]||(l[30]=E('<div class="section about"><div class="avatar-container"><div class="avatar-image"></div></div><a href="https://github.com/xiaowine" target="_blank"><div class="github-icon"></div></a><div class="author-name">xiao_wine</div></div>',1))]))}})).mount("#app");
