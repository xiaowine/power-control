import{o as a,c as l,w as e,T as t,a as s,b as n,t as i,r as u,n as o,d as c,h as v,e as r,f as d,g as p,i as m,j as f,k as g,F as y,l as b,m as h}from"./vendor-BPOXP2S0.js";!function(){const a=document.createElement("link").relList;if(!(a&&a.supports&&a.supports("modulepreload"))){for(const a of document.querySelectorAll('link[rel="modulepreload"]'))l(a);new MutationObserver((a=>{for(const e of a)if("childList"===e.type)for(const a of e.addedNodes)"LINK"===a.tagName&&"modulepreload"===a.rel&&l(a)})).observe(document,{childList:!0,subtree:!0})}function l(a){if(a.ep)return;a.ep=!0;const l=function(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),"use-credentials"===a.crossOrigin?l.credentials="include":"anonymous"===a.crossOrigin?l.credentials="omit":l.credentials="same-origin",l}(a);fetch(a.href,l)}}();const C={class:"dialog-header"},k={class:"dialog-content"},V={class:"dialog-footer"},w=((a,l)=>{const e=a.__vccOpts||a;for(const[t,s]of l)e[t]=s;return e})({__name:"Dialog",props:{modelValue:{type:Boolean,default:!1},title:{type:String,default:"提示"},width:{type:String,default:"400px"},closeOnClickOverlay:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(v,{emit:r}){const d=v,p=r,m=()=>{p("update:modelValue",!1)},f=()=>{d.closeOnClickOverlay&&m()};return(r,d)=>(a(),l(t,{name:"dialog-fade"},{default:e((()=>[v.modelValue?(a(),s("div",{key:0,class:"dialog-overlay",onClick:f},[n("div",{class:"dialog-container",style:o({width:v.width})},[n("div",C,[n("h3",null,i(v.title),1),n("button",{class:"dialog-close",onClick:m},"×")]),n("div",k,[u(r.$slots,"default",{},void 0,!0)]),n("div",V,[u(r.$slots,"footer",{},void 0,!0)])],4)])):c("",!0)])),_:3}))}},[["__scopeId","data-v-ccada074"]]);function O(a={}){try{const{title:l="提示",content:e="",width:t="400px",closeOnClickOverlay:s=!0,footer:n=null,onClose:i=()=>{},onOpen:u=()=>{},className:o=""}=a,c=document.createElement("div");o&&c.classList.add(o),document.body.appendChild(c);const m={visible:r(!0),title:r(l),content:r(e)},f=()=>{try{g.unmount(),c.remove(),i(),m.currentDialog=null}catch(a){}},g=d({setup(){p((()=>{try{u()}catch(a){}}));return()=>v(w,{modelValue:m.visible.value,"onUpdate:modelValue":a=>{m.visible.value=a,a||f()},title:m.title.value,width:t,closeOnClickOverlay:s,class:o},{default:()=>"string"==typeof m.content.value?m.content.value:v(m.content.value),...n&&{footer:()=>v(n)}})}});g.mount(c);const y={close:()=>{m.visible.value=!1,f()},updateContent:a=>{m.content.value=a},updateTitle:a=>{m.title.value=a}};return m.currentDialog=y,y}catch(l){throw new Error("Failed to create dialog")}}const A={dialogs:new Set,add(a){this.dialogs.add(a)},remove(a){this.dialogs.delete(a)},closeAll(){this.dialogs.forEach((a=>a.close())),this.dialogs.clear()},get count(){return this.dialogs.size}};function E(a,l={}){return O({title:"警告",content:a,width:"300px",footer:{setup:()=>()=>v("button",{onClick:()=>A.closeAll(),style:{width:"100%",margin:"0",backgroundColor:"var(--error-color)",color:"white"}},"确定")},className:"alert-dialog",...l})}const _={class:"power-control-system"},L={class:"section status-section"},T={class:"port-config"},F={class:"connection-status"},R={class:"input-parameters"},S={class:"card-grid"},N={class:"card"},x={class:"value-container"},I={class:"value-display"},B={class:"card"},U={class:"value-container"},D={class:"value-display"},M={class:"section output-section"},P={class:"card-grid"},j={class:"card"},K={class:"value-container"},q={class:"value-display"},G={class:"card"},W={class:"value-container"},X={class:"value-display"},$={class:"card"},z={class:"value-container"},H={class:"value-display"},J={class:"card"},Q={class:"value-container"},Y={class:"value-display"},Z={class:"section target-settings"},aa=["value"],la=["value"],ea={class:"section power-status"},ta={class:"status-tabs"},sa={class:"status-tab"},na={class:"status-options"},ia={class:"status-tab"},ua={class:"status-options"},oa={class:"status-tab"},ca={class:"status-options"},va={class:"status-tab"},ra={class:"status-options error-options"},da={class:"section"},pa={class:"info-container"},ma={class:"info"},fa=["onClick"],ga={class:"type"},ya={class:"message"};d({__name:"App",setup(l){const e=r(null),t=r(null),u=r(null),o=r(null),c=r(),d=r(!1),C=r(24),k=r(5),V=r(24),w=r(5),A=r("BUCK"),ba=r("未工作"),ha=r("CC"),Ca=r("正常"),ka=r([]),Va=r(24),wa=r(5),Oa=r(24),Aa=r(5),Ea=r(24),_a=r(5),La=r(0),Ta=r(0);let Fa,Ra,Sa,Na=[],xa=0,Ia={FunctionCode:0,Value:0,CheckValue:0};const Ba=0,Ua=1,Da=2,Ma=3,Pa=4,ja=5,Ka=6,qa={BUCK:0,BOOST:1,MIXED:2},Ga={CV:0,CC:1},Wa={OFFLINE:0,OVERCURRENT:1,OVERVOLTAGE:2,OVERTEMP:3};p((()=>{})),m((()=>{Ja()}));const Xa=(a,l)=>a.toFixed(l).padStart(5,"0"),$a=async()=>{"serial"in navigator?d.value?await Ja():await za():E("浏览器不支持串口通信")},za=async()=>{try{c.value=await navigator.serial.requestPort(),await c.value.open({baudRate:115200}),d.value=!0,Ha()}catch(a){E("串口打开失败，请检查设备连接"),await Ja()}},Ha=async()=>{Fa=c.value.readable.getReader();try{for(;d.value;){const{value:a,done:l}=await Fa.read();if(l)break;a&&(Na.push(...a),Ra||(Ra=setTimeout(Qa,30)))}}catch(a){E("数据读取错误，连接已断开")}finally{null==Fa||Fa.releaseLock()}},Ja=async()=>{try{Fa&&(await Fa.cancel(),Fa.releaseLock()),c.value&&await c.value.close()}catch(a){}finally{c.value=void 0,d.value=!1,clearTimeout(Ra),clearTimeout(Sa),Na=[]}},Qa=()=>{if(6===Na.length){let a=new Uint8Array(Na);Za(a),ol(a)}else Ya();Na=[],Ra=null},Ya=()=>{xa>10?(E("收到过多无效数据，已自动关闭串口"),Ja(),xa=0,Sa=null):(xa++,Sa=null,Sa=setTimeout((()=>{xa>10&&(E("收到过多无效数据，已自动关闭串口"),Ja()),xa=0,Sa=null}),6e4))},Za=a=>{var l;if(Ia.FunctionCode=a[1]<<8|a[0],Ia.Value=a[3]<<8|a[2],Ia.CheckValue=a[5]<<8|a[4],cl(a)!==Ia.CheckValue)return void Ya();const e={[Ba]:()=>al("voltage",Ia.Value/100,!0),[Ua]:()=>al("voltage",Ia.Value/100,!0),[Da]:()=>al("voltage",Ia.Value/100,!1),[Ma]:()=>al("current",Ia.Value/100,!1),[Ba]:()=>al("voltage",Ia.Value/100,!0),[Ua]:()=>al("current",Ia.Value/100,!0),[Pa]:()=>ll(Ia.Value),[ja]:()=>el(Ia.Value),[Ka]:()=>tl(Ia.Value)};null==(l=e[Ia.FunctionCode])||l.call(e)},al=(a,l,e=!1)=>{const t=e?"voltage"===a?Oa:Aa:"voltage"===a?V:w,s=e?"voltage"===a?Ea:_a:"voltage"===a?Va:wa;if(t.value!==l){if(s.value=t.value,t.value=l,"voltage"===a||"current"===a){Ta.value=V.value*w.value;const a=Oa.value*Aa.value;a>0&&(La.value=Math.min(Ta.value/a*100,100))}vl(a,e)}},ll=a=>{const l={[Wa.OFFLINE]:"电源掉线",[Wa.OVERCURRENT]:"过流",[Wa.OVERVOLTAGE]:"过压",[Wa.OVERTEMP]:"过温"};Ca.value=l[a]||"未知错误"},el=a=>{var l;const e=null==(l=Object.entries(qa).find((([l,e])=>e===a)))?void 0:l[0];e&&(A.value=e)},tl=a=>{var l;const e=null==(l=Object.entries(Ga).find((([l,e])=>e===a)))?void 0:l[0];e&&(ha.value=e)},sl=a=>{"voltage"===a?V.value!==C.value&&(Va.value=V.value,V.value=C.value,vl("voltage")):"current"===a&&w.value!==k.value&&(wa.value=w.value,w.value=k.value,vl("current"))},nl=()=>{ba.value="工作中"},il=()=>{ba.value="未工作"},ul=()=>{ka.value=[]},ol=(a,l="received")=>{const e=Array.from(a).map((a=>a.toString(16).padStart(2,"0"))).join(" "),t=(new Date).toLocaleString();ka.value.length>=100&&ka.value.pop(),ka.value.unshift({message:e,type:l,timestamp:t})},cl=a=>{let l=0;for(let e=0;e<4;e++)l+=a[e];return l&=65535,l},vl=(a,l=!1)=>{const s=l?"voltage"===a?u:o:"voltage"===a?e:"current"===a?t:"efficiency"===a?efficiencyAnimation:powerAnimation;s.value&&(s.value.classList.remove("fade-in"),s.value.offsetWidth,s.value.classList.add("fade-in"))},rl=(a,l)=>"efficiency"===a||"power"===a?l.toFixed(1):Xa(l,2);return(l,r)=>(a(),s("div",_,[n("div",L,[r[11]||(r[11]=n("h3",null,"设备状态",-1)),n("div",T,[n("div",F,[n("i",{class:f(["status-icon",{connected:d.value}])},null,2),n("span",null,i(void 0===c.value?"未连接":"已连接"),1)]),n("button",{class:"connect-btn",onClick:$a},i(d.value?"断开连接":"选择设备"),1)]),n("div",R,[r[10]||(r[10]=n("h4",null,"输入参数",-1)),n("div",S,[n("div",N,[r[6]||(r[6]=n("span",{class:"output-label"},"电压",-1)),n("div",x,[n("span",I,[g(i(Xa(Oa.value,2))+" ",1),r[4]||(r[4]=n("small",null,"V",-1))]),n("span",{class:"value-display value-animation",ref_key:"inputVoltageAnimation",ref:u},[g(i(Xa(Ea.value,2))+" ",1),r[5]||(r[5]=n("small",null,"V",-1))],512)])]),n("div",B,[r[9]||(r[9]=n("span",{class:"output-label"},"电流",-1)),n("div",U,[n("span",D,[g(i(Xa(Aa.value,2))+" ",1),r[7]||(r[7]=n("small",null,"A",-1))]),n("span",{class:"value-display value-animation",ref_key:"inputCurrentAnimation",ref:o},[g(i(Xa(_a.value,2))+" ",1),r[8]||(r[8]=n("small",null,"A",-1))],512)])])])])]),n("div",M,[r[22]||(r[22]=n("h3",null,"输出参数",-1)),n("div",P,[n("div",j,[r[14]||(r[14]=n("span",{class:"output-label"},"电压",-1)),n("div",K,[n("span",q,[g(i(Xa(V.value,2))+" ",1),r[12]||(r[12]=n("small",null,"V",-1))]),n("span",{class:"value-display value-animation",ref_key:"voltageAnimation",ref:e},[g(i(Xa(Va.value,2))+" ",1),r[13]||(r[13]=n("small",null,"V",-1))],512)])]),n("div",G,[r[17]||(r[17]=n("span",{class:"output-label"},"电流",-1)),n("div",W,[n("span",X,[g(i(Xa(w.value,2))+" ",1),r[15]||(r[15]=n("small",null,"A",-1))]),n("span",{class:"value-display value-animation",ref_key:"currentAnimation",ref:t},[g(i(Xa(wa.value,2))+" ",1),r[16]||(r[16]=n("small",null,"A",-1))],512)])]),n("div",$,[r[19]||(r[19]=n("span",{class:"output-label"},"效率",-1)),n("div",z,[n("span",H,[g(i(rl("efficiency",La.value))+" ",1),r[18]||(r[18]=n("small",null,"%",-1))])])]),n("div",J,[r[21]||(r[21]=n("span",{class:"output-label"},"功耗",-1)),n("div",Q,[n("span",Y,[g(i(rl("power",Ta.value))+" ",1),r[20]||(r[20]=n("small",null,"W",-1))])])])])]),n("div",Z,[r[25]||(r[25]=n("h3",null,"目标设定",-1)),n("div",null,[n("label",null,[n("input",{type:"number",oninput:"if(value>80)value=80;if(value.length>4)value=value.slice(0,4);if(value<0)value=0",value:C.value,onInput:r[0]||(r[0]=a=>{return(l=a.target.value)<0&&(l=0),l>80&&(l=80),void(C.value=parseFloat(l));var l})},null,40,aa),r[23]||(r[23]=g(" V "))]),n("button",{onClick:r[1]||(r[1]=a=>sl("voltage"))},"设定电压")]),n("div",null,[n("label",null,[n("input",{type:"number",oninput:"if(value>5)value=5;if(value.length>4)value=value.slice(0,4);if(value<0)value=0",value:k.value,onInput:r[2]||(r[2]=a=>{return(l=a.target.value)<0&&(l=0),l>5&&(l=5),void(k.value=parseFloat(l));var l})},null,40,la),r[24]||(r[24]=g(" A "))]),n("button",{onClick:r[3]||(r[3]=a=>sl("current"))},"设定电流")]),n("div",null,[n("button",{onClick:nl},"开机"),n("button",{onClick:il},"关机")])]),n("div",ea,[r[30]||(r[30]=n("h3",null,"电源状态",-1)),n("div",ta,[n("div",sa,[r[26]||(r[26]=n("div",{class:"status-label"},"工作模式",-1)),n("div",na,[(a(),s(y,null,b(["BUCK","BOOST","MIXED"],(a=>n("span",{key:a,class:f(["status-option",{active:A.value===a}])},i(a),3))),64))])]),n("div",ia,[r[27]||(r[27]=n("div",{class:"status-label"},"工作状态",-1)),n("div",ua,[(a(),s(y,null,b(["未工作","工作中"],(a=>n("span",{key:a,class:f(["status-option",{active:ba.value===a}])},i(a),3))),64))])]),n("div",oa,[r[28]||(r[28]=n("div",{class:"status-label"},"输出模式",-1)),n("div",ca,[(a(),s(y,null,b(["CV","CC"],(a=>n("span",{key:a,class:f(["status-option",{active:ha.value===a}])},i(a),3))),64))])]),n("div",va,[r[29]||(r[29]=n("div",{class:"status-label"},"故障类型",-1)),n("div",ra,[(a(),s(y,null,b(["正常","断线","过流","过压","过温"],(a=>n("span",{key:a,class:f(["status-option",{active:Ca.value===a}])},i(a),3))),64))])])])]),n("div",da,[r[31]||(r[31]=n("h3",null,"发送/接收数据",-1)),n("div",pa,[n("ul",ma,[(a(!0),s(y,null,b(ka.value,((l,e)=>(a(),s("li",{key:e,class:f([l.type,"clickable"]),onClick:a=>(a=>{const l=O({title:"数据详情",width:"500px",content:{setup:()=>()=>v("div",{class:"data-detail"},[v("div",{class:"detail-item"},[v("span",{class:"detail-label"},"类型:"),v("span",{class:"detail-value"},"sent"===a.type?"发送":"接收")]),v("div",{class:"detail-item"},[v("span",{class:"detail-label"},"时间:"),v("span",{class:"detail-value"},a.timestamp)]),v("div",{class:"detail-item"},[v("span",{class:"detail-label"},"数据:"),v("span",{class:"detail-value"},a.message)]),v("div",{class:"detail-item"},[v("span",{class:"detail-label"},"解释:"),v("span",{class:"detail-value"},"AAAAAAAA")])])},footer:{setup:()=>()=>v("button",{onClick:()=>l.close()},"关闭")}})})(l)},[n("span",ga,i("sent"===l.type?"发送":"接收")+":",1),n("span",ya,i(l.message),1)],10,fa)))),128))]),n("button",{class:"clear-btn",onClick:ul,title:"清除历史记录"})])]),r[32]||(r[32]=h('<div class="section about"><div class="avatar-container"><div class="avatar-image"></div></div><a href="https://github.com/xiaowine" target="_blank"><div class="github-icon"></div></a><div class="author-name">xiao_wine</div></div>',1))]))}}).mount("#app");
