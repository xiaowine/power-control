import{d as a,o as e,c as l,w as s,T as t,a as n,b as i,t as o,r as c,e as u,f as r,h as v,g as d,m as p,i as m,j as g,k as f,n as V,l as y,u as b,F as C,p as O,q as E}from"./vendor-DCq9QlA3.js";!function(){const a=document.createElement("link").relList;if(!(a&&a.supports&&a.supports("modulepreload"))){for(const a of document.querySelectorAll('link[rel="modulepreload"]'))e(a);new MutationObserver((a=>{for(const l of a)if("childList"===l.type)for(const a of l.addedNodes)"LINK"===a.tagName&&"modulepreload"===a.rel&&e(a)})).observe(document,{childList:!0,subtree:!0})}function e(a){if(a.ep)return;a.ep=!0;const e=function(a){const e={};return a.integrity&&(e.integrity=a.integrity),a.referrerPolicy&&(e.referrerPolicy=a.referrerPolicy),"use-credentials"===a.crossOrigin?e.credentials="include":"anonymous"===a.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(a);fetch(a.href,e)}}();const k={class:"dialog-header"},w={class:"dialog-content"},h={key:0,class:"dialog-footer"},T=a({__name:"Dialog",props:{modelValue:{type:Boolean,default:!1},title:{default:"提示"},closeOnClickOverlay:{type:Boolean,default:!0},content:{default:void 0},footer:{default:void 0}},emits:["update:modelValue"],setup(a,{emit:v}){const d=a,p=v,m=()=>{p("update:modelValue",!1)},g=()=>{d.closeOnClickOverlay&&m()};return(a,v)=>(e(),l(t,{name:"dialog-fade"},{default:s((()=>[a.modelValue?(e(),n("div",{key:0,class:"dialog-overlay",onClick:g},[i("div",{class:"dialog-container",onClick:v[0]||(v[0]=r((()=>{}),["stop"]))},[i("div",k,[i("h3",null,o(a.title),1),i("button",{class:"close-btn",onClick:m},"×")]),i("div",w,[(e(),l(c(a.content)))]),a.footer?(e(),n("div",h,[(e(),l(c(a.footer)))])):u("",!0)])])):u("",!0)])),_:1}))}});function R(a){const{title:e="提示",content:l={},closeOnClickOverlay:s=!0,footer:t=null,onClose:n=()=>{},onOpen:i=()=>{},className:o=""}=a,c=document.createElement("div");o&&c.classList.add(o),document.body.appendChild(c);const u={visible:d(!0),title:d(e),content:d(p(l))},r=()=>{f.unmount(),c.remove(),n(),u.currentDialog=void 0},f=m({setup:()=>(g((()=>i())),()=>v(T,{modelValue:u.visible.value??!1,"onUpdate:modelValue":a=>{u.visible.value=a,a||r()},title:u.title.value??"",closeOnClickOverlay:s,class:o,content:u.content.value,footer:t}))});f.mount(c);const V={close:()=>{u.visible.value=!1,r()},updateContent:a=>{u.content.value=a},updateTitle:a=>{u.title.value=a}};return u.currentDialog=V,V}function N(a,e={}){const l=R({title:"警告",content:{setup:()=>()=>v("h3",{class:"data-detail"},a)},footer:{setup:()=>()=>v("div",{class:"dialog-footer"},[v("button",{onClick:()=>l.close(),style:{backgroundColor:"var(--error-color)",color:"white"}},"确定")])},className:"alert-dialog",...e});return l}const U=(a,e)=>a.toFixed(e).padStart(5,"0"),_=a=>{let e=0;for(let l=0;l<4;l++)e+=a[l];return e&=65535,e},I=a=>({FunctionCode:a[1]<<8|a[0],Value:a[3]<<8|a[2],CheckValue:a[5]<<8|a[4]}),D=(a,e)=>"efficiency"===a||"power"===a?e.toFixed(1):U(e,2);var A=(a=>(a[a.EN=0]="EN",a[a.VREF=1]="VREF",a[a.IREF=2]="IREF",a[a.OUT_MODE=3]="OUT_MODE",a))(A||{}),M=(a=>(a[a.VIN=0]="VIN",a[a.IIN=1]="IIN",a[a.VOUT=2]="VOUT",a[a.IOUT=3]="IOUT",a[a.RUN_ERROR_TYPE=4]="RUN_ERROR_TYPE",a[a.RUN_MODE=5]="RUN_MODE",a[a.OUT_MODE=6]="OUT_MODE",a[a.EN=7]="EN",a))(M||{});const F={class:"power-control-system"},L={class:"section status-section"},P={class:"port-config"},x={class:"connection-status"},S={class:"input-parameters"},$={class:"card-grid"},B={class:"card"},j={class:"value-container"},G={class:"value-display"},Y={class:"card"},K={class:"value-container"},W={class:"value-display"},q={class:"section output-section"},z={class:"card-grid"},X={class:"card"},H={class:"value-container"},J={class:"value-display"},Q={class:"card"},Z={class:"value-container"},aa={class:"value-display"},ea={class:"card"},la={class:"value-container"},sa={class:"value-display"},ta={class:"card"},na={class:"value-container"},ia={class:"value-display"},oa={class:"section target-settings"},ca={class:"target-controls"},ua={class:"target-group"},ra={class:"target-value"},va={class:"target-value"},da={class:"control-group"},pa={class:"power-controls"},ma={class:"mode-controls"},ga={class:"section power-status"},fa={class:"status-tabs"},Va={class:"status-tab"},ya={class:"status-options"},ba={class:"status-tab"},Ca={class:"status-options"},Oa={class:"status-tab"},Ea={class:"status-options"},ka={class:"status-tab"},wa={class:"status-options error-options"},ha={class:"section"},Ta={class:"info-container"},Ra={class:"info"},Na=["onClick"],Ua={class:"type"},_a={class:"message"};m(a({__name:"App",setup(a){const l=d(),s=d(),t=d(),c=d(),u=d(),r=d(!1),p=d(20),m=d(4),k=d(24),w=d(5),h=d(24),T=d(5),Ia=d(24),Da=d(5),Aa=d(24),Ma=d(5),Fa=d(0),La=d(0),Pa=d("BUCK"),xa=d("未工作"),Sa=d("CV"),$a=d("正常"),Ba=d([]);let ja,Ga=[],Ya=0,Ka=0,Wa=0;const qa={BUCK:0,BOOST:1,MIXED:2},za={CV:0,CC:1},Xa={NONE:0,OVERCURRENT:1,OVERVOLTAGE:2,OVERTEMP:3};g((()=>{})),f((()=>{Ha()}));const Ha=async()=>{try{ja&&(await ja.cancel(),ja.releaseLock()),u.value&&await u.value.close()}catch(a){}finally{u.value=void 0,r.value=!1,clearTimeout(Ya),clearTimeout(Wa),Ga=[]}},Ja=async()=>{"serial"in navigator?r.value?await Ha():await(async()=>{try{u.value=await navigator.serial.requestPort(),await u.value.open({baudRate:115200}),r.value=!0,Qa()}catch(a){N("串口打开失败，请检查设备连接"),await Ha()}})():N("浏览器不支持串口通信")},Qa=async()=>{var a;if((null==(a=u.value)?void 0:a.readable)&&(ja=u.value.readable.getReader(),ja))try{for(;r.value;){const{value:a,done:e}=await ja.read();if(e)break;a&&(Ga.push(...Array.from(a)),0===Ya&&(Ya=window.setTimeout(Za,30)))}}catch(e){N("数据读取错误，连接已断开")}finally{null==ja||ja.releaseLock()}},Za=()=>{var a;if(clearTimeout(Ya),Ya=0,6===Ga.length){const e=new Uint8Array(Ga),l=I(e);if(_(e)!==l.CheckValue)return ne(),void(Ga=[]);const s={[M.VIN]:()=>ae("voltage",l.Value/100,!0),[M.IIN]:()=>ae("current",l.Value/100,!0),[M.VOUT]:()=>ae("voltage",l.Value/100,!1),[M.IOUT]:()=>ae("current",l.Value/100,!1),[M.RUN_ERROR_TYPE]:()=>oe(l.Value),[M.RUN_MODE]:()=>re(l.Value),[M.OUT_MODE]:()=>ve(l.Value),[M.EN]:()=>de(l.Value)};null==(a=s[l.FunctionCode])||a.call(s),fe(e)}else ne();Ga=[]},ae=(a,e,l=!1)=>{const s=l?"voltage"===a?Ia.value:Da.value:"voltage"===a?k.value:w.value;s!==e&&((l?"voltage"===a?Aa:Ma:"voltage"===a?h:T).value=s,l?"voltage"===a?Ia.value=e:Da.value=e:"voltage"===a?k.value=e:w.value=e,ee(),Ve(a,l))},ee=()=>{La.value=k.value*w.value;const a=Ia.value*Da.value;a>0&&(Fa.value=Math.min(La.value/a*100,100))},le=(a,e,l)=>{var s;if(!(null==(s=u.value)?void 0:s.writable))return void N("请先连接设备");const t=new Uint8Array([255&a,a>>8&255,255&e,e>>8&255,0,0]),n=u.value.writable.getWriter(),i=_(t);t[4]=255&i,t[5]=i>>8&255,n.write(t),n.releaseLock(),fe(t,"sent")},se=()=>le(A.EN,1),te=()=>le(A.EN,0),ne=()=>{Ka>10?(N("收到过多无效数据，已自动关闭串口"),Ha(),Ka=0,clearTimeout(Wa)):(Ka++,clearTimeout(Wa),Wa=window.setTimeout((()=>{Ka>10&&(N("收到过多无效数据，已自动关闭串口"),Ha()),Ka=0,clearTimeout(Wa)}),6e4))};function ie(a){return{[Xa.NONE]:"正常",[Xa.OVERCURRENT]:"过流",[Xa.OVERVOLTAGE]:"过压",[Xa.OVERTEMP]:"过温"}[a]??"正常"}const oe=a=>{$a.value=ie(a)};function ce(a,e,l){var s;return(null==(s=Object.entries(e).find((([e,l])=>l===a)))?void 0:s[0])??l}const ue=(a,e,l,s)=>{var t;const n=null==(t=Object.entries(e).find((([e,l])=>l===a)))?void 0:t[0];l.value=n||s},re=a=>{ue(a,qa,Pa,"未知运行模式")},ve=a=>{ue(a,za,Sa,"未知输出模式")},de=a=>{xa.value=1===a?"工作中":"未工作"};function pe(a){return ce(a,za,"未知输出模式")}function me(a,e){try{const s=new Uint8Array(a.split(" ").map((a=>parseInt(a,16)))),t=I(s),n={[A.VREF]:`设置电压: ${t.Value/100} V`,[A.IREF]:`设置电流: ${t.Value/100} A`,[A.EN]:""+(1===t.Value?"开机":"关机"),[A.OUT_MODE]:"设置模式: "+(0===t.Value?"CV":"CC")},i={[M.VIN]:`输入电压: ${t.Value/100} V`,[M.IIN]:`输入电流: ${t.Value/100} A`,[M.VOUT]:`输出电压: ${t.Value/100} V`,[M.IOUT]:`输出电流: ${t.Value/100} A`,[M.RUN_ERROR_TYPE]:`错误类型: ${ie(t.Value)}`,[M.RUN_MODE]:`运行模式: ${l=t.Value,ce(l,qa,"未知运行模式")}`,[M.OUT_MODE]:`输出模式: ${pe(t.Value)}`};return e?n[t.FunctionCode]:i[t.FunctionCode]}catch(s){return"数据解析错误"}var l}const ge=()=>{Ba.value=[]},fe=(a,e="received")=>{const l=Array.from(a).map((a=>a.toString(16).padStart(2,"0"))).join(" "),s=(new Date).toLocaleString();Ba.value.length>=100&&Ba.value.pop(),Ba.value.unshift({message:l,type:e,timestamp:s})},Ve=(a,e=!1)=>{const n=e?"voltage"===a?t:c:"voltage"===a?l:s;(null==n?void 0:n.value)&&(n.value.classList.remove("fade-in"),n.value.offsetWidth,n.value.classList.add("fade-in"))},ye=a=>{const e="voltage"===a,l=d(e?p.value:m.value),s=e?80:5,t=e?"V":"A",n=R({title:"设置"+(e?"电压":"电流"),content:{setup:()=>()=>v("div",{class:"dialog-input-container"},[v("input",{type:"number",value:l.value,onInput:a=>{const e=a.target.value,t=parseFloat(e);l.value=t>s?s:t<0?0:t},class:"dialog-input",placeholder:`请输入${e?"电压":"电流"}值`}),v("span",{class:"dialog-unit"},t)])},footer:{setup:()=>()=>v("div",{class:"dialog-footer"},[v("button",{onClick:()=>n.close(),class:"cancel-btn"},"取消"),v("button",{onClick:()=>{e?(p.value=l.value,le(A.VREF,Math.round(100*p.value))):(m.value=l.value,le(A.IREF,Math.round(100*m.value))),n.close()},class:"confirm-btn"},"确定")])}})},be=()=>ye("voltage"),Ce=()=>ye("current"),Oe=a=>{Sa.value!==a&&le(A.OUT_MODE,"CV"===a?0:1)};return(a,d)=>(e(),n("div",F,[i("div",L,[d[8]||(d[8]=i("h3",null,"设备状态",-1)),i("div",P,[i("div",x,[i("i",{class:V(["status-icon",{connected:r.value}])},null,2),i("span",null,o(void 0===u.value?"未连接":"已连接"),1)]),i("button",{class:"connect-btn",onClick:Ja},o(r.value?"断开连接":"选择设备"),1)]),i("div",S,[i("div",$,[i("div",B,[d[4]||(d[4]=i("span",{class:"output-label"},"电压",-1)),i("div",j,[i("span",G,[y(o(b(U)(Ia.value,2))+" ",1),d[2]||(d[2]=i("small",null,"V",-1))]),i("span",{class:"value-display value-animation",ref_key:"inputVoltageAnimation",ref:t},[y(o(b(U)(Aa.value,2))+" ",1),d[3]||(d[3]=i("small",null,"V",-1))],512)])]),i("div",Y,[d[7]||(d[7]=i("span",{class:"output-label"},"电流",-1)),i("div",K,[i("span",W,[y(o(b(U)(Da.value,2))+" ",1),d[5]||(d[5]=i("small",null,"A",-1))]),i("span",{class:"value-display value-animation",ref_key:"inputCurrentAnimation",ref:c},[y(o(b(U)(Ma.value,2))+" ",1),d[6]||(d[6]=i("small",null,"A",-1))],512)])])])])]),i("div",q,[d[19]||(d[19]=i("h3",null,"输出参数",-1)),i("div",z,[i("div",X,[d[11]||(d[11]=i("span",{class:"output-label"},"电压",-1)),i("div",H,[i("span",J,[y(o(b(U)(k.value,2))+" ",1),d[9]||(d[9]=i("small",null,"V",-1))]),i("span",{class:"value-display value-animation",ref_key:"voltageAnimation",ref:l},[y(o(b(U)(h.value,2))+" ",1),d[10]||(d[10]=i("small",null,"V",-1))],512)])]),i("div",Q,[d[14]||(d[14]=i("span",{class:"output-label"},"电流",-1)),i("div",Z,[i("span",aa,[y(o(b(U)(w.value,2))+" ",1),d[12]||(d[12]=i("small",null,"A",-1))]),i("span",{class:"value-display value-animation",ref_key:"currentAnimation",ref:s},[y(o(b(U)(T.value,2))+" ",1),d[13]||(d[13]=i("small",null,"A",-1))],512)])]),i("div",ea,[d[16]||(d[16]=i("span",{class:"output-label"},"效率",-1)),i("div",la,[i("span",sa,[y(o(b(D)("efficiency",Fa.value))+" ",1),d[15]||(d[15]=i("small",null,"%",-1))])])]),i("div",ta,[d[18]||(d[18]=i("span",{class:"output-label"},"功耗",-1)),i("div",na,[i("span",ia,[y(o(b(D)("power",La.value))+" ",1),d[17]||(d[17]=i("small",null,"W",-1))])])])])]),i("div",oa,[d[23]||(d[23]=i("h3",null,"目标设定",-1)),i("div",ca,[i("div",ua,[i("div",{class:"target-card",onClick:be},[i("div",ra,o(p.value)+"V",1),d[20]||(d[20]=i("div",{class:"target-label"},"设置电压",-1))]),i("div",{class:"target-card",onClick:Ce},[i("div",va,o(m.value)+"A",1),d[21]||(d[21]=i("div",{class:"target-label"},"设置电流",-1))])]),i("div",da,[i("div",pa,[i("button",{class:V(["power-btn",{active:"工作中"===xa.value}]),onClick:se},d[22]||(d[22]=[i("img",{src:"data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1733847952494'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='4318'%20data-darkreader-inline-fill=''%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='256'%20height='256'%3e%3cpath%20d='M561.312102%2068.191078l-98.624205%200%200%20493.121024%2098.624205%200L561.312102%2068.191078zM799.735283%20174.951591l-69.77618%2069.77618c77.420277%2063.36619%20127.225613%20159.27761%20127.225613%20267.271206%200%20190.590779-154.592914%20345.184717-345.184717%20345.184717S166.815283%20702.590779%20166.815283%20512c0-107.993596%2049.805336-203.905016%20127.225613-267.271206l-69.77618-69.77618C129.0911%20256.316713%2068.191078%20376.884696%2068.191078%20512c0%20245.080811%20198.72811%20443.808922%20443.808922%20443.808922s443.808922-198.72811%20443.808922-443.808922C955.808922%20376.884696%20894.907876%20256.316713%20799.735283%20174.951591z'%20p-id='4319'%3e%3c/path%3e%3c/svg%3e",alt:"power",class:"power-icon"},null,-1),y(" 开机 ")]),2),i("button",{class:"power-btn off",onClick:te},"关机")]),i("div",ma,[i("button",{class:V({active:"CV"===Sa.value}),onClick:d[0]||(d[0]=a=>Oe("CV"))},"CV",2),i("button",{class:V({active:"CC"===Sa.value}),onClick:d[1]||(d[1]=a=>Oe("CC"))},"CC",2)])])])]),i("div",ga,[d[28]||(d[28]=i("h3",null,"电源状态",-1)),i("div",fa,[i("div",Va,[d[24]||(d[24]=i("div",{class:"status-label"},"工作模式",-1)),i("div",ya,[(e(),n(C,null,O(["BUCK","BOOST","MIXED"],(a=>i("span",{key:a,class:V(["status-option",{active:Pa.value===a}])},o(a),3))),64))])]),i("div",ba,[d[25]||(d[25]=i("div",{class:"status-label"},"工作状态",-1)),i("div",Ca,[(e(),n(C,null,O(["未工作","工作中"],(a=>i("span",{key:a,class:V(["status-option",{active:xa.value===a}])},o(a),3))),64))])]),i("div",Oa,[d[26]||(d[26]=i("div",{class:"status-label"},"输出模式",-1)),i("div",Ea,[(e(),n(C,null,O(["CV","CC"],(a=>i("span",{key:a,class:V(["status-option",{active:Sa.value===a}])},o(a),3))),64))])]),i("div",ka,[d[27]||(d[27]=i("div",{class:"status-label"},"故障类型",-1)),i("div",wa,[(e(),n(C,null,O(["正常","过流","过压","过温"],(a=>i("span",{key:a,class:V(["status-option",{active:$a.value===a}])},o(a),3))),64))])])])]),i("div",ha,[d[29]||(d[29]=i("h3",null,"发送/接收数据",-1)),i("div",Ta,[i("ul",Ra,[(e(!0),n(C,null,O(Ba.value,((a,l)=>(e(),n("li",{key:l,class:V([a.type,"clickable"]),onClick:e=>(a=>{const e=R({title:"数据详情",content:{setup:()=>()=>v("div",{class:"data-detail"},[v("div",{class:"detail-item"},[v("span",{class:"detail-label"},"类型:"),v("span",{class:"detail-value"},"sent"===a.type?"发送":"接收")]),v("div",{class:"detail-item"},[v("span",{class:"detail-label"},"时间:"),v("span",{class:"detail-value"},a.timestamp)]),v("div",{class:"detail-item"},[v("span",{class:"detail-label"},"数据:"),v("span",{class:"detail-value"},a.message)]),v("div",{class:"detail-item"},[v("span",{class:"detail-label"},"解释:"),v("span",{class:"detail-value"},me(a.message,"sent"===a.type))])])},footer:{setup:()=>()=>v("button",{onClick:()=>e.close()},"关闭")}})})(a)},[i("span",Ua,o("sent"===a.type?"发送":"接收")+":",1),i("span",_a,o(a.message),1)],10,Na)))),128))]),i("button",{class:"clear-btn",onClick:ge,title:"清除历史记录"})])]),d[30]||(d[30]=E('<div class="section about"><div class="avatar-container"><div class="avatar-image"></div></div><a href="https://github.com/xiaowine" target="_blank"><div class="github-icon"></div></a><div class="author-name">xiao_wine</div></div>',1))]))}})).mount("#app");
